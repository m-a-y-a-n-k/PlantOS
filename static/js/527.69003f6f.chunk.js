"use strict";(self.webpackChunkplantos=self.webpackChunkplantos||[]).push([[527],{527:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(43);const i=class{constructor(e,t){var n=this;this.webcamElement=void 0,this.canvasElement=void 0,this.adjustVideoSize=(e,t)=>{const n=e/t;e>=t?this.webcamElement.width=n*this.webcamElement.height:this.webcamElement.height=this.webcamElement.width/n},this.setup=async()=>new Promise((e,t)=>{void 0!==navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(t=>{"srcObject"in this.webcamElement?this.webcamElement.srcObject=t:this.webcamElement.src=window.URL.createObjectURL(t),this.webcamElement.addEventListener("loadeddata",async()=>{this.adjustVideoSize(this.webcamElement.videoWidth,this.webcamElement.videoHeight),e()},!1)}):t()}),this._drawImage=()=>{const e=this.webcamElement.videoWidth,t=this.webcamElement.videoHeight,n=this.canvasElement.getContext("2d");if(!n)throw new Error("Could not get 2D context from canvas");return this.canvasElement.width=e,this.canvasElement.height=t,n.drawImage(this.webcamElement,0,0,e,t),{imageHeight:t,imageWidth:e}},this.takeBlobPhoto=()=>{const{imageWidth:e,imageHeight:t}=this._drawImage();return new Promise((n,a)=>{this.canvasElement.toBlob(a=>{n({blob:a,imageHeight:t,imageWidth:e})})})},this.takeBase64Photo=function(){let{type:e,quality:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"png",quality:1};const{imageHeight:a,imageWidth:i}=n._drawImage(),s=(e||"png").toLowerCase(),l="jpeg"===s||"jpg"===s?Math.min(1,Math.max(0,null!==t&&void 0!==t?t:.92)):void 0;return{base64:n.canvasElement.toDataURL("image/"+s,l),imageHeight:a,imageWidth:i}},this.webcamElement=e,this.canvasElement=t}},s=window.ml5;async function l(e,t){const n=new Image;n.src=e,await n.decode();const a=function(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=224,t.height=224,n.drawImage(e,0,0,224,224);const a=n.getImageData(0,0,224,224),i=a.data;for(let s=0;s<i.length;s+=4)if(i[s+1]=Math.min(255,1.1*i[s+1]),s>4&&s<i.length-4){const e=(i[s-4]+i[s]+i[s+4])/3,t=(i[s-3]+i[s+1]+i[s+5])/3,n=(i[s-2]+i[s+2]+i[s+6])/3;i[s]=e,i[s+1]=t,i[s+2]=n}return n.putImageData(a,0,0),t}(n),i=[];if(t.mobilenet)try{const e=await t.mobilenet.classify(a);i.push(...e.map(e=>{var t,n;return{label:String(null!==(t=e.label)&&void 0!==t?t:""),confidence:Number(null!==(n=e.confidence)&&void 0!==n?n:0),model:"MobileNet"}}))}catch(r){console.warn("MobileNet classification failed:",r)}const s=["plant","leaf","flower","tree","grass","herb","fern","moss","succulent","cactus","vine","shrub","bush","weed","bloom","petal","stem","root","seed","fruit","vegetable","crop"],l=i.filter(e=>s.some(t=>e.label.toLowerCase().includes(t))),o=i.sort((e,t)=>t.confidence-e.confidence);return l.length>0?l.sort((e,t)=>t.confidence-e.confidence):o}function o(){const[e,t]=(0,a.useState)({mobilenet:null}),[n,i]=(0,a.useState)(!0),[o,r]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{i(!0),r(null);const n=await(e="MobileNet",new Promise((t,n)=>{if(null!==s&&void 0!==s&&s.imageClassifier)try{const a=s.imageClassifier(e,()=>{t(a)});a&&"function"===typeof a.then&&a.then(t).catch(n)}catch(a){n(a)}else n(new Error("ml5 is not available. Ensure it is loaded in public/index.html"))}));t({mobilenet:n}),i(!1)}catch(n){r(n instanceof Error?n.message:"Failed to load AI models"),i(!1)}var e})()},[]);return{detect:l,ready:!n&&!o&&e.mobilenet,classifiers:e,loading:n,error:o,modelCount:Object.values(e).filter(Boolean).length}}var r=n(555);const c=new class{constructor(){this.apiKeys=void 0,this.baseUrls=void 0,this.cache=void 0,this.cacheTimeout=void 0,this.apiKeys={plantId:{NODE_ENV:"production",PUBLIC_URL:"/PlantOS",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_PLANT_ID_API_KEY,perenual:{NODE_ENV:"production",PUBLIC_URL:"/PlantOS",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_PERENUAL_API_KEY,plantNet:{NODE_ENV:"production",PUBLIC_URL:"/PlantOS",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_PLANTNET_API_KEY},this.baseUrls={plantId:"https://api.plant.id/v3",perenual:"https://perenual.com/api",plantNet:"https://my-api.plantnet.org/v1",trefle:"https://trefle.io/api/v1"},this.cache=new Map,this.cacheTimeout=864e5}base64ToBlob(e){const t=atob(e.split(",")[1]),n=new Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);const a=new Uint8Array(n);return new Blob([a],{type:"image/jpeg"})}async identifyWithPlantId(e){if(!this.apiKeys.plantId)throw new Error("Plant.id API key not configured");const t=this.base64ToBlob(e),n=new FormData;n.append("images",t),n.append("language","en"),n.append("health","all"),n.append("disease_level","all"),n.append("symptoms","true"),n.append("similar_images","true"),n.append("details",["common_names","url","description","taxonomy","rank","gbif_id","inaturalist_id","image","synonyms","edible_parts","watering","propagation_methods"].join(",")),n.append("disease_details",["common_names","classification","description","treatment","local_name"].join(","));try{const e=await fetch("".concat(this.baseUrls.plantId,"/identify"),{method:"POST",headers:{"Api-Key":this.apiKeys.plantId},body:n});if(!e.ok)throw new Error("Plant.id API error: ".concat(e.status));const t=await e.json();return this.formatPlantIdResponse(t)}catch(a){throw console.error("Plant.id identification failed:",a),a}}async getPlantCareInfo(e){if(!this.apiKeys.perenual)return console.warn("Perenual API key not configured, using fallback data"),this.getFallbackPlantInfo(e);const t="perenual_".concat(e),n=this.getCachedData(t);if(n)return n;try{const n=await fetch("".concat(this.baseUrls.perenual,"/species-list?key=").concat(this.apiKeys.perenual,"&q=").concat(encodeURIComponent(e)));if(!n.ok)throw new Error("Perenual search error: ".concat(n.status));const a=await n.json();if(a.data&&a.data.length>0){const e=a.data[0].id,n=await fetch("".concat(this.baseUrls.perenual,"/species/details/").concat(e,"?key=").concat(this.apiKeys.perenual));if(n.ok){const e=await n.json(),a=this.formatPerenualResponse(e);return this.setCachedData(t,a),a}}return this.getFallbackPlantInfo(e)}catch(a){return console.error("Perenual API failed:",a),this.getFallbackPlantInfo(e)}}async identifyWithPlantNet(e){if(!this.apiKeys.plantNet)throw new Error("PlantNet API key not configured");const t=this.base64ToBlob(e),n=new FormData;n.append("images",t),n.append("organs","leaf"),n.append("nb-results","5");try{const e=await fetch("".concat(this.baseUrls.plantNet,"/identify/weurope?api-key=").concat(this.apiKeys.plantNet),{method:"POST",body:n});if(!e.ok)throw new Error("PlantNet API error: ".concat(e.status));const t=await e.json();return this.formatPlantNetResponse(t)}catch(a){throw console.error("PlantNet identification failed:",a),a}}async identifyPlant(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=[];try{const t=await this.identifyWithPlantId(e);t&&t.confidence>.3&&n.push((0,r.A)((0,r.A)({},t),{},{source:"Plant.id"}))}catch(a){console.warn("Plant.id failed, trying alternatives")}try{const t=await this.identifyWithPlantNet(e);t&&t.confidence>.2&&n.push((0,r.A)((0,r.A)({},t),{},{source:"PlantNet"}))}catch(a){console.warn("PlantNet failed")}if(t)try{const e=await this.getPlantCareInfo(t);e&&n.push((0,r.A)((0,r.A)({},e),{},{source:"Perenual",fromML:!0}))}catch(a){console.warn("Care info retrieval failed")}return n.length>0?n.sort((e,t)=>(t.confidence||0)-(e.confidence||0))[0]:this.getFallbackPlantInfo(t||"Unknown Plant")}formatPlantIdResponse(e){var t,n,a,i,s,l,o,r,c,d,u,h,m,g,p,v,f,b,w,y,j,x,N,P;const _=null!==(t=null===e||void 0===e||null===(n=e.result)||void 0===n||null===(a=n.classification)||void 0===a||null===(i=a.suggestions)||void 0===i?void 0:i[0])&&void 0!==t?t:null===e||void 0===e||null===(s=e.suggestions)||void 0===s?void 0:s[0];if(!_)return null;const C=null!==(l=null!==(o=null===_||void 0===_?void 0:_.details)&&void 0!==o?o:null===_||void 0===_?void 0:_.plant_details)&&void 0!==l?l:{},I=null!==(r=null===C||void 0===C?void 0:C.taxonomy)&&void 0!==r?r:{},S=null!==(c=null!==(d=null===e||void 0===e||null===(u=e.result)||void 0===u?void 0:u.is_plant)&&void 0!==d?d:null===e||void 0===e||null===(h=e.result)||void 0===h?void 0:h.isPlant)&&void 0!==c?c:void 0,E=null!==(m=null!==(g=null===e||void 0===e||null===(p=e.result)||void 0===p?void 0:p.is_healthy)&&void 0!==g?g:null===e||void 0===e||null===(v=e.result)||void 0===v?void 0:v.isHealthy)&&void 0!==m?m:void 0,A=null!==(f=null===e||void 0===e||null===(b=e.result)||void 0===b?void 0:b.disease)&&void 0!==f?f:void 0,k=null!==(w=null===A||void 0===A||null===(y=A.suggestions)||void 0===y?void 0:y.map(e=>{var t;return{id:e.id,name:String(null!==(t=e.name)&&void 0!==t?t:"Unknown issue"),probability:"number"===typeof e.probability?e.probability:void 0,nonHarmful:"boolean"===typeof e.non_harmful?e.non_harmful:void 0,details:e.details,similarImages:e.similar_images}}))&&void 0!==w?w:[];return{label:(null===(j=C.common_names)||void 0===j?void 0:j[0])||C.scientific_name||_.name,scientificName:C.scientific_name||_.name,confidence:_.probability,description:(null===(x=C.description)||void 0===x?void 0:x.value)||C.description||"No description available",commonNames:C.common_names||[],family:null===I||void 0===I?void 0:I.family,genus:null===I||void 0===I?void 0:I.genus,watering:(null===(N=C.watering)||void 0===N?void 0:N.max)||C.watering||"Regular watering",light:"Bright indirect light",propagation:C.propagation_methods||[],edibleParts:C.edible_parts||[],image:(null===(P=C.image)||void 0===P?void 0:P.value)||C.image,gbifId:C.gbif_id,inaturalistId:C.inaturalist_id,synonyms:C.synonyms||[],isPlant:S?{binary:S.binary,probability:S.probability}:void 0,healthAssessment:E||k.length>0?{isHealthy:E?{binary:E.binary,probability:E.probability}:void 0,diseases:k,defectScore:null===A||void 0===A?void 0:A.defect_score}:void 0,source:"Plant.id"}}formatPlantNetResponse(e){var t,n;if(!e.results||0===e.results.length)return null;const a=e.results[0],i=a.species;return{label:(null===(t=i.commonNames)||void 0===t?void 0:t[0])||i.scientificNameWithoutAuthor,scientificName:i.scientificNameWithoutAuthor,confidence:a.score,description:"".concat(i.genus.scientificNameWithoutAuthor," species"),family:i.family.scientificNameWithoutAuthor,genus:i.genus.scientificNameWithoutAuthor,images:(null===(n=a.images)||void 0===n?void 0:n.map(e=>e.url.o))||[],source:"PlantNet"}}formatPerenualResponse(e){var t,n,a,i,s,l,o,r,c;return{label:e.common_name||(null===(t=e.scientific_name)||void 0===t?void 0:t[0]),scientificName:null===(n=e.scientific_name)||void 0===n?void 0:n[0],confidence:.7,description:e.description||"No description available",watering:e.watering||"Regular watering",light:(null===(a=e.sunlight)||void 0===a?void 0:a.join(", "))||"Bright indirect light",source:"Perenual",care:{hardiness:null!==(i=e.hardiness)&&void 0!==i&&i.min&&null!==(s=e.hardiness)&&void 0!==s&&s.max?"Zones ".concat(e.hardiness.min,"-").concat(e.hardiness.max):"Unknown",maintenance:e.maintenance||"Medium",growthRate:e.growth_rate||"Medium",droughtTolerant:e.drought_tolerant||!1,saltTolerant:e.salt_tolerant||!1,thorny:e.thorny||!1,invasive:e.invasive||!1,tropical:e.tropical||!1,indoor:e.indoor||!1,careLevel:e.care_level||"Medium"},dimensions:{minHeight:null===(l=e.dimension)||void 0===l?void 0:l.min_value,maxHeight:null===(o=e.dimension)||void 0===o?void 0:o.max_value,unit:null===(r=e.dimension)||void 0===r?void 0:r.unit},image:null===(c=e.default_image)||void 0===c?void 0:c.original_url,cycle:e.cycle,attracts:e.attracts||[],propagation:e.propagation||[],pruningMonth:e.pruning_month||[],pruningCount:e.pruning_count||[],seeds:e.seeds||0,flowers:e.flowers||!1,flowering_season:e.flowering_season,color:e.flower_color,soilRequirements:e.soil||[]}}getFallbackPlantInfo(e){const t={daisy:{label:"Daisy",scientificName:"Bellis perennis",description:"A common flowering plant with white petals and yellow center.",light:"Full sun to partial shade",watering:"Regular watering, allow soil to dry between waterings",uses:"Ornamental, medicinal (traditional use)"},rose:{label:"Rose",scientificName:"Rosa spp.",description:"Popular flowering shrub known for its fragrant blooms.",light:"Full sun (6+ hours daily)",watering:"Deep watering 1-2 times per week",uses:"Ornamental, cut flowers, essential oils"},sunflower:{label:"Sunflower",scientificName:"Helianthus annuus",description:"Large flowering plant that follows the sun across the sky.",light:"Full sun",watering:"Regular watering, drought tolerant when established",uses:"Seeds for food and oil, ornamental"}},n=e.toLowerCase().replace(/[^a-z]/g,"");for(const[a,i]of Object.entries(t))if(n.includes(a)||a.includes(n))return(0,r.A)({confidence:.5,source:"Fallback"},i);return{label:e||"Unknown Plant",scientificName:"Species not identified",description:"This appears to be a plant, but we could not identify the specific species. Consider consulting a local botanist or plant identification expert.",light:"Varies by species - observe current growing conditions",watering:"Monitor soil moisture - most plants prefer soil that dries slightly between waterings",uses:"Unknown - research before consumption or medicinal use",confidence:.1,source:"Generic Fallback"}}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}};async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(t){return await c.identifyPlant(t,e)}return await c.getPlantCareInfo(e)}catch(n){return console.error("Plant info fetch failed:",n),c.getFallbackPlantInfo(e)}}var u=n(927),h=n(56),m=n(579);const g=e=>{var t,n,i,s,l,r,c,g,p,v;let{capturedImage:f,closeDialog:b}=e;const{detect:w,ready:y,classifiers:j,loading:x,error:N,modelCount:P}=o(),[_,C]=(0,a.useState)(null),[I,S]=(0,a.useState)(!1),[E,A]=(0,a.useState)(null),{setCurrentPlant:k,addToHistory:T,setDetecting:D,setDetectionProgress:R,setDetectionStep:H,preferences:M}=(0,h.gi)();(0,a.useEffect)(()=>{y&&f&&(async()=>{try{var e,t,n;S(!0),A(null),D(!0),H("Analyzing image with AI models..."),R(10);const a=await w(f,j);R(40),H("Identifying plant species...");let i=null;a.length>0&&(i=a[0]),R(60),H("Fetching detailed plant information...");const s=await d((null===(e=i)||void 0===e?void 0:e.label)||"Unknown Plant",f);if(R(90),H("Finalizing results..."),s&&i&&(s.mlConfidence=i.confidence,s.mlModel=i.model,s.combinedConfidence=(i.confidence+(s.confidence||0))/2),!1===(null===s||void 0===s||null===(t=s.isPlant)||void 0===t?void 0:t.binary)&&(null!==(n=s.isPlant.probability)&&void 0!==n?n:0)>.6)throw new Error("This image does not appear to contain a plant. Try focusing on leaves/flowers and improving lighting.");C(s),k(s),R(100),M.autoSave&&s&&T(s,f)}catch(a){console.error("Plant detection failed:",a),A(a instanceof Error?a.message:"Detection failed");try{const e=await d("Unknown Plant");C(e),k(e)}catch(i){console.error("Fallback also failed:",i)}}finally{S(!1),D(!1),R(0),H("")}})()},[y,f,w,j,k,T,M.autoSave,D,R,H]);const{detectionState:W}=(0,h.gi)();return x||I?(0,m.jsx)("div",{className:"plant-info-dialog",children:(0,m.jsxs)("div",{className:"plant-info-card",children:[(0,m.jsx)("span",{className:"plant-info-dialog-close",onClick:b,children:"\xd7"}),(0,m.jsx)(u.A,{size:"large",message:x?"Loading AI models...":"Analyzing Plant...",progress:W.progress,step:W.currentStep}),P>0&&(0,m.jsxs)("p",{className:"model-info",children:["Using ",P," AI model",P>1?"s":""]})]})}):N||E?(0,m.jsx)("div",{className:"plant-info-dialog",children:(0,m.jsxs)("div",{className:"plant-info-card",children:[(0,m.jsx)("span",{className:"plant-info-dialog-close",onClick:b,children:"\xd7"}),(0,m.jsx)("h2",{children:"Detection Error"}),(0,m.jsx)("p",{children:"We encountered an issue while analyzing your plant:"}),(0,m.jsx)("p",{className:"error-message",children:N||E}),(0,m.jsx)("p",{children:"Please try again with a clearer image of the plant."})]})}):_?(0,m.jsx)("div",{className:"plant-info-dialog",children:(0,m.jsxs)("div",{className:"plant-info-card",children:[(0,m.jsx)("span",{className:"plant-info-dialog-close",onClick:b,children:"\xd7"}),(0,m.jsxs)("div",{className:"plant-header",children:[(0,m.jsx)("h2",{className:"plant-name",children:_.label}),_.scientificName&&(0,m.jsx)("p",{className:"plant-scientific",children:(0,m.jsx)("em",{children:_.scientificName})}),(0,m.jsxs)("div",{className:"confidence-info",children:[_.combinedConfidence&&(0,m.jsxs)("span",{className:"confidence-badge",children:[Math.round(100*_.combinedConfidence),"% confident"]}),_.source&&(0,m.jsxs)("span",{className:"source-badge",children:["via ",_.source]}),_.mlModel&&(0,m.jsx)("span",{className:"model-badge",children:_.mlModel})]})]}),_.image&&(0,m.jsx)("div",{className:"plant-image-container",children:(0,m.jsx)("img",{className:"plant-image",src:_.image,alt:_.label,onError:e=>{e.target.style.display="none"}})}),_.description&&(0,m.jsxs)("div",{className:"plant-section",children:[(0,m.jsx)("h3",{children:"Description"}),(0,m.jsx)("p",{className:"plant-description",children:_.description})]}),(0,m.jsxs)("div",{className:"care-info",children:[_.light&&(0,m.jsxs)("div",{className:"care-item",children:[(0,m.jsx)("strong",{children:"\ud83d\udca1 Light:"})," ",_.light]}),(_.water||_.watering)&&(0,m.jsxs)("div",{className:"care-item",children:[(0,m.jsx)("strong",{children:"\ud83d\udca7 Water:"})," ",_.water||_.watering]}),(null===(t=_.care)||void 0===t?void 0:t.maintenance)&&(0,m.jsxs)("div",{className:"care-item",children:[(0,m.jsx)("strong",{children:"\ud83d\udd27 Maintenance:"})," ",_.care.maintenance]}),(null===(n=_.care)||void 0===n?void 0:n.hardiness)&&(0,m.jsxs)("div",{className:"care-item",children:[(0,m.jsx)("strong",{children:"\ud83c\udf21\ufe0f Hardiness:"})," ",_.care.hardiness]})]}),((null===(i=_.healthAssessment)||void 0===i?void 0:i.isHealthy)||(null!==(s=null===(l=_.healthAssessment)||void 0===l||null===(r=l.diseases)||void 0===r?void 0:r.length)&&void 0!==s?s:0)>0)&&(0,m.jsxs)("div",{className:"plant-section",children:[(0,m.jsx)("h3",{children:"Health Assessment"}),(null===(c=_.healthAssessment)||void 0===c?void 0:c.isHealthy)&&(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Status:"})," ",_.healthAssessment.isHealthy.binary?"Likely healthy":"Potential issues detected","number"===typeof _.healthAssessment.isHealthy.probability&&(0,m.jsxs)(m.Fragment,{children:[" (",Math.round(100*_.healthAssessment.isHealthy.probability),"%)"]})]}),(null!==(g=null===(p=_.healthAssessment)||void 0===p||null===(v=p.diseases)||void 0===v?void 0:v.length)&&void 0!==g?g:0)>0&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{children:(0,m.jsx)("strong",{children:"Top suspected issues:"})}),(0,m.jsx)("ul",{children:_.healthAssessment.diseases.slice(0,3).map((e,t)=>{var n;return(0,m.jsxs)("li",{children:[e.name,"number"===typeof e.probability?" (".concat(Math.round(100*e.probability),"%)"):"",e.nonHarmful?" (non-harmful)":""]},"".concat(null!==(n=e.id)&&void 0!==n?n:e.name,"_").concat(t))})})]})]}),(_.family||_.genus)&&(0,m.jsxs)("div",{className:"plant-section",children:[(0,m.jsx)("h3",{children:"Taxonomy"}),_.family&&(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Family:"})," ",_.family]}),_.genus&&(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Genus:"})," ",_.genus]})]}),_.commonNames&&_.commonNames.length>1&&(0,m.jsxs)("div",{className:"plant-section",children:[(0,m.jsx)("h3",{children:"Common Names"}),(0,m.jsx)("p",{children:_.commonNames.join(", ")})]}),_.uses&&(0,m.jsxs)("div",{className:"plant-section",children:[(0,m.jsx)("h3",{children:"Uses"}),(0,m.jsx)("p",{children:_.uses})]}),_.edibleParts&&_.edibleParts.length>0&&(0,m.jsxs)("div",{className:"plant-section",children:[(0,m.jsx)("h3",{children:"\u26a0\ufe0f Edible Parts"}),(0,m.jsx)("p",{children:_.edibleParts.join(", ")}),(0,m.jsx)("p",{className:"warning",children:(0,m.jsx)("small",{children:"Always verify plant identification before consumption!"})})]}),_.propagation&&_.propagation.length>0&&(0,m.jsxs)("div",{className:"plant-section",children:[(0,m.jsx)("h3",{children:"Propagation"}),(0,m.jsx)("p",{children:_.propagation.join(", ")})]}),!1]})}):(0,m.jsx)("div",{className:"plant-info-dialog",children:(0,m.jsxs)("div",{className:"plant-info-card",children:[(0,m.jsx)("span",{className:"plant-info-dialog-close",onClick:b,children:"\xd7"}),(0,m.jsx)("h2",{children:"Plant Not Detected"}),(0,m.jsx)("p",{children:"We couldn't identify a plant in this image."}),(0,m.jsx)("p",{children:"Please try again with:"}),(0,m.jsxs)("ul",{children:[(0,m.jsx)("li",{children:"A clearer image of the plant"}),(0,m.jsx)("li",{children:"Better lighting conditions"}),(0,m.jsx)("li",{children:"Focus on leaves, flowers, or distinctive features"})]})]})})};var p=n(820);const v=e=>{let{type:t="info",title:n,message:i,onClose:s,closable:l=!0,autoClose:o=!1,autoCloseDelay:r=5e3,className:c=""}=e;const[d,u]=a.useState(!0),h=(0,a.useCallback)(()=>{u(!1),setTimeout(()=>{null===s||void 0===s||s()},300)},[s]);if((0,a.useEffect)(()=>{if(o&&s){const e=setTimeout(()=>{h()},r);return()=>clearTimeout(e)}},[o,r,s,h]),!d)return null;return(0,m.jsx)("div",{className:"alert-box alert-".concat(t," ").concat(c),children:(0,m.jsxs)("div",{className:"alert-content",children:[(0,m.jsx)("div",{className:"alert-icon",children:(()=>{switch(t){case"success":return"\u2705";case"error":return"\u274c";case"warning":return"\u26a0\ufe0f";default:return"\u2139\ufe0f"}})()}),(0,m.jsxs)("div",{className:"alert-text",children:[n&&(0,m.jsx)("div",{className:"alert-title",children:n}),(0,m.jsx)("div",{className:"alert-message",children:i})]}),l&&(0,m.jsx)("button",{className:"alert-close",onClick:h,"aria-label":"Close alert",children:"\xd7"})]})})},f=a.memo(e=>{let{offline:t}=e;const[n,s]=(0,a.useState)(null),[l,o]=(0,a.useState)(!1),[r,c]=(0,a.useState)(!1),[d,f]=(0,a.useState)(!1),[b,w]=(0,a.useState)(null),y=(0,h.EY)(),j=(0,h.dV)(),{addToHistory:x,setCurrentPlant:N}=(0,h.Yb)(),{setCameraActive:P,setCameraError:_}=(0,h.MI)(),C=(0,a.useRef)(null),I=(0,a.useRef)(null),S=(0,a.useCallback)(()=>{w(null)},[]),E=(0,a.useCallback)(async()=>{if(I.current)try{const e=I.current.takeBase64Photo({type:"jpeg",quality:.9});o(!0),s(e.base64),j&&y&&x(y,e.base64)}catch(e){console.error("Failed to capture image:",e),_("Failed to capture image. Please try again.")}},[j,y,x,_]),A=(0,a.useCallback)(()=>{o(!1),s(null),N(null)},[N]),k=(0,a.useCallback)(e=>{c(!1),200===e.status?(y&&n&&x(y,n),w("Plant saved to your collection!"),A()):w("Sorry, we encountered an error saving your plant")},[c,A,y,n,x]),T=(0,a.useCallback)(()=>{if(n)if(t){const e="cloudy_pwa_",t=Math.random().toString(36).substring(2,5);localStorage.setItem("".concat(e).concat(t),n),w("Image saved locally, it will be uploaded to your library once internet connection is detected"),A()}else c(!0),k({status:200})},[n,t,A,k]),D=(0,a.useCallback)(e=>{const t=[];for(const n in localStorage)if(localStorage.hasOwnProperty(n)&&n.match(e)){const e=localStorage.getItem(n);localStorage.removeItem(n),t.push({key:n,val:e})}return t},[]),R=(0,a.useMemo)(()=>n?(0,m.jsx)(p.A,{src:n,alt:"captured plant",width:"350",height:"275",quality:.7,loading:"eager"}):null,[n]),H=(0,a.useCallback)(e=>()=>{f(e)},[]),M=(0,a.useMemo)(()=>l?(0,m.jsxs)("div",{className:"button-group",children:[(0,m.jsx)("button",{className:"discardButton",onClick:A,children:"Discard Plant"}),(0,m.jsx)("button",{className:"captureButton",onClick:E,children:"Scan Another"}),(0,m.jsx)("button",{className:"uploadButton",onClick:T,children:"\ud83d\udcbe Save Plant"}),(0,m.jsx)("button",{className:"infoButton",onClick:H(!0),children:"Show Plant Info"})]}):(0,m.jsx)("button",{className:"captureButton",onClick:E,children:"Scan Plant"}),[l,A,E,T,H]),W=(0,a.useMemo)(()=>r?(0,m.jsx)(u.A,{message:"Saving plant to your collection...",size:"small"}):null,[r]);return(0,a.useEffect)(()=>{const e=document.createElement("canvas");C.current&&(I.current=new i(C.current,e),I.current.setup().then(()=>{P(!0),_(null)}).catch(e=>{console.error("Camera setup failed:",e),_("Error getting access to your camera. Please check permissions."),P(!1)}))},[P,_]),(0,a.useEffect)(()=>{t||(()=>{const e=D(/^cloudy_pwa_/);e.length>0&&(c(!0),e.forEach(e=>{k({status:200})}),c(!1),w("All saved images have been uploaded to your Library"))})()},[t,k,D]),(0,m.jsxs)("div",{className:"uploadCanvas",children:[(0,m.jsxs)("div",{className:"scan-card",children:[(0,m.jsxs)("div",{className:"mediaGroup",children:[(0,m.jsx)("video",{autoPlay:!0,playsInline:!0,muted:!0,ref:C,width:"100vw",height:"275"}),R&&(0,m.jsxs)("figure",{className:"imageCanvas",children:[R,(0,m.jsx)("figcaption",{children:"Image captured from feed."})]})]}),!l&&(0,m.jsx)("p",{className:"scan-hint",children:"Tip: fill the frame with leaves/flowers for best results."}),M,W,b&&(0,m.jsx)(v,{type:"info",message:b,onClose:S})]}),d&&n&&(0,m.jsx)(g,{capturedImage:n,closeDialog:H(!1)})]})});f.displayName="Canvas";const b=f},820:(e,t,n)=>{n.d(t,{A:()=>l});var a=n(43),i=n(579);const s=a.memo(e=>{let{src:t,alt:n,width:s,height:l,className:o="",onClick:r,placeholder:c="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzUwIiBoZWlnaHQ9IjI3NSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkxvYWRpbmcuLi48L3RleHQ+PC9zdmc+",quality:d=.8,loading:u="lazy"}=e;const[h,m]=(0,a.useState)(c),[g,p]=(0,a.useState)(!1),[v,f]=(0,a.useState)("eager"===u),[b,w]=(0,a.useState)(!1),y=(0,a.useRef)(null),j=(0,a.useRef)(null),x=(0,a.useCallback)((e,t)=>new Promise(n=>{const a=document.createElement("canvas"),i=a.getContext("2d"),s=new Image;s.onload=()=>{const e=Math.min(800/s.width,800/s.height);a.width=s.width*e,a.height=s.height*e,null===i||void 0===i||i.drawImage(s,0,0,a.width,a.height);const l=a.toDataURL("image/jpeg",t);n(l)},s.src=e}),[]);(0,a.useEffect)(()=>{if("eager"!==u&&!v)return j.current=new IntersectionObserver(e=>{let[t]=e;var n;t.isIntersecting&&(f(!0),null===(n=j.current)||void 0===n||n.disconnect())},{threshold:.1,rootMargin:"50px"}),y.current&&j.current.observe(y.current),()=>{var e;null===(e=j.current)||void 0===e||e.disconnect()}},[u,v]),(0,a.useEffect)(()=>{if(!v)return;(async()=>{try{if(p(!1),w(!1),t.startsWith("data:image/")){const e=await x(t,d);m(e)}else m(t);p(!0)}catch(e){console.error("Failed to load image:",e),w(!0),m(c)}})()},[t,v,x,d,c]);const N=(0,a.useCallback)(()=>{p(!0)},[]),P=(0,a.useCallback)(()=>{w(!0),m(c)},[c]);return(0,i.jsxs)("div",{className:"optimized-image-container ".concat(o," ").concat(g?"loaded":"loading"," ").concat(b?"error":""),style:{width:s,height:l},onClick:r,children:[(0,i.jsx)("img",{ref:y,src:h,alt:n,className:"optimized-image",onLoad:N,onError:P,loading:u,style:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.3s ease-in-out"}}),!g&&!b&&(0,i.jsx)("div",{className:"image-loading-overlay",children:(0,i.jsx)("div",{className:"loading-spinner"})}),b&&(0,i.jsxs)("div",{className:"image-error-overlay",children:[(0,i.jsx)("span",{children:"\u26a0\ufe0f"}),(0,i.jsx)("p",{children:"Failed to load image"})]})]})});s.displayName="OptimizedImage";const l=s}}]);
//# sourceMappingURL=527.69003f6f.chunk.js.map