"use strict";(self.webpackChunkplantos=self.webpackChunkplantos||[]).push([[527],{527:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var n=a(43);const i=class{constructor(e,t){var a=this;this.webcamElement=void 0,this.canvasElement=void 0,this.adjustVideoSize=(e,t)=>{const a=e/t;e>=t?this.webcamElement.width=a*this.webcamElement.height:this.webcamElement.height=this.webcamElement.width/a},this.setup=async()=>new Promise((e,t)=>{void 0!==navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(t=>{"srcObject"in this.webcamElement?this.webcamElement.srcObject=t:this.webcamElement.src=window.URL.createObjectURL(t),this.webcamElement.addEventListener("loadeddata",async()=>{this.adjustVideoSize(this.webcamElement.videoWidth,this.webcamElement.videoHeight),e()},!1)}):t()}),this._drawImage=()=>{const e=this.webcamElement.videoWidth,t=this.webcamElement.videoHeight,a=this.canvasElement.getContext("2d");if(!a)throw new Error("Could not get 2D context from canvas");return this.canvasElement.width=e,this.canvasElement.height=t,a.drawImage(this.webcamElement,0,0,e,t),{imageHeight:t,imageWidth:e}},this.takeBlobPhoto=()=>{const{imageWidth:e,imageHeight:t}=this._drawImage();return new Promise((a,n)=>{this.canvasElement.toBlob(n=>{a({blob:n,imageHeight:t,imageWidth:e})})})},this.takeBase64Photo=function(){let{type:e,quality:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"png",quality:1};const{imageHeight:n,imageWidth:i}=a._drawImage();return{base64:a.canvasElement.toDataURL("image/"+e,t),imageHeight:n,imageWidth:i}},this.webcamElement=e,this.canvasElement=t}};var s=a(555);const l=window.ml5;async function o(e,t){const a=new Image;a.src=e,await a.decode();const n=function(e){const t=document.createElement("canvas"),a=t.getContext("2d");t.width=224,t.height=224,a.drawImage(e,0,0,224,224);const n=a.getImageData(0,0,224,224),i=n.data;for(let s=0;s<i.length;s+=4)if(i[s+1]=Math.min(255,1.1*i[s+1]),s>4&&s<i.length-4){const e=(i[s-4]+i[s]+i[s+4])/3,t=(i[s-3]+i[s+1]+i[s+5])/3,a=(i[s-2]+i[s+2]+i[s+6])/3;i[s]=e,i[s+1]=t,i[s+2]=a}return a.putImageData(n,0,0),t}(a),i=[];if(t.mobilenet)try{const e=await t.mobilenet.classify(n);i.push(...e.map(e=>(0,s.A)((0,s.A)({},e),{},{model:"MobileNet"})))}catch(c){console.warn("MobileNet classification failed:",c)}if(t.densenet)try{const e=await t.densenet.classify(n);i.push(...e.map(e=>(0,s.A)((0,s.A)({},e),{},{model:"DenseNet"})))}catch(c){console.warn("DenseNet classification failed:",c)}const l=["plant","leaf","flower","tree","grass","herb","fern","moss","succulent","cactus","vine","shrub","bush","weed","bloom","petal","stem","root","seed","fruit","vegetable","crop"],o=i.filter(e=>l.some(t=>e.label.toLowerCase().includes(t)));return o.length>0?o.sort((e,t)=>t.confidence-e.confidence):i.sort((e,t)=>t.confidence-e.confidence)}function c(){const[e,t]=(0,n.useState)({mobilenet:null,densenet:null}),[a,i]=(0,n.useState)(!0),[s,c]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{i(!0);const a=l.imageClassifier("MobileNet");let n=null;try{n=l.imageClassifier("DenseNet")}catch(e){console.warn("DenseNet not available, using MobileNet only:",e)}t({mobilenet:a,densenet:n}),i(!1)}catch(a){c(a instanceof Error?a.message:"Failed to load AI models"),i(!1)}})()},[]);return{detect:o,ready:!a&&!s&&e.mobilenet,classifiers:e,loading:a,error:s,modelCount:Object.values(e).filter(Boolean).length}}const r=new class{constructor(){this.apiKeys=void 0,this.baseUrls=void 0,this.cache=void 0,this.cacheTimeout=void 0,this.apiKeys={plantId:{NODE_ENV:"production",PUBLIC_URL:"/PlantOS",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_PUBLIC_URL:"localhost:3000",REACT_APP_TOKEN:"WmecwPhdSnDGtuRL86ttqLTvOGKF8sRNNajHkk3RqFU"}.REACT_APP_PLANT_ID_API_KEY,perenual:{NODE_ENV:"production",PUBLIC_URL:"/PlantOS",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_PUBLIC_URL:"localhost:3000",REACT_APP_TOKEN:"WmecwPhdSnDGtuRL86ttqLTvOGKF8sRNNajHkk3RqFU"}.REACT_APP_PERENUAL_API_KEY,plantNet:{NODE_ENV:"production",PUBLIC_URL:"/PlantOS",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_PUBLIC_URL:"localhost:3000",REACT_APP_TOKEN:"WmecwPhdSnDGtuRL86ttqLTvOGKF8sRNNajHkk3RqFU"}.REACT_APP_PLANTNET_API_KEY},this.baseUrls={plantId:"https://api.plant.id/v3",perenual:"https://perenual.com/api",plantNet:"https://my-api.plantnet.org/v1",trefle:"https://trefle.io/api/v1"},this.cache=new Map,this.cacheTimeout=864e5}base64ToBlob(e){const t=atob(e.split(",")[1]),a=new Array(t.length);for(let i=0;i<t.length;i++)a[i]=t.charCodeAt(i);const n=new Uint8Array(a);return new Blob([n],{type:"image/jpeg"})}async identifyWithPlantId(e){if(!this.apiKeys.plantId)throw new Error("Plant.id API key not configured");const t=this.base64ToBlob(e),a=new FormData;a.append("images",t),a.append("modifiers",JSON.stringify(["crops_fast","similar_images","health_only","disease_similar_images"])),a.append("plant_language","en"),a.append("plant_details",JSON.stringify(["common_names","url","description","taxonomy","rank","gbif_id","inaturalist_id","image","synonyms","edible_parts","watering","propagation_methods"]));try{const e=await fetch("".concat(this.baseUrls.plantId,"/identification"),{method:"POST",headers:{"Api-Key":this.apiKeys.plantId},body:a});if(!e.ok)throw new Error("Plant.id API error: ".concat(e.status));const t=await e.json();return this.formatPlantIdResponse(t)}catch(n){throw console.error("Plant.id identification failed:",n),n}}async getPlantCareInfo(e){if(!this.apiKeys.perenual)return console.warn("Perenual API key not configured, using fallback data"),this.getFallbackPlantInfo(e);const t="perenual_".concat(e),a=this.getCachedData(t);if(a)return a;try{const a=await fetch("".concat(this.baseUrls.perenual,"/species-list?key=").concat(this.apiKeys.perenual,"&q=").concat(encodeURIComponent(e)));if(!a.ok)throw new Error("Perenual search error: ".concat(a.status));const n=await a.json();if(n.data&&n.data.length>0){const e=n.data[0].id,a=await fetch("".concat(this.baseUrls.perenual,"/species/details/").concat(e,"?key=").concat(this.apiKeys.perenual));if(a.ok){const e=await a.json(),n=this.formatPerenualResponse(e);return this.setCachedData(t,n),n}}return this.getFallbackPlantInfo(e)}catch(n){return console.error("Perenual API failed:",n),this.getFallbackPlantInfo(e)}}async identifyWithPlantNet(e){if(!this.apiKeys.plantNet)throw new Error("PlantNet API key not configured");const t=this.base64ToBlob(e),a=new FormData;a.append("images",t),a.append("organs","leaf"),a.append("nb-results","5");try{const e=await fetch("".concat(this.baseUrls.plantNet,"/identify/weurope?api-key=").concat(this.apiKeys.plantNet),{method:"POST",body:a});if(!e.ok)throw new Error("PlantNet API error: ".concat(e.status));const t=await e.json();return this.formatPlantNetResponse(t)}catch(n){throw console.error("PlantNet identification failed:",n),n}}async identifyPlant(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=[];try{const t=await this.identifyWithPlantId(e);t&&t.confidence>.3&&a.push((0,s.A)((0,s.A)({},t),{},{source:"Plant.id"}))}catch(n){console.warn("Plant.id failed, trying alternatives")}try{const t=await this.identifyWithPlantNet(e);t&&t.confidence>.2&&a.push((0,s.A)((0,s.A)({},t),{},{source:"PlantNet"}))}catch(n){console.warn("PlantNet failed")}if(t)try{const e=await this.getPlantCareInfo(t);e&&a.push((0,s.A)((0,s.A)({},e),{},{source:"Perenual",fromML:!0}))}catch(n){console.warn("Care info retrieval failed")}return a.length>0?a.sort((e,t)=>(t.confidence||0)-(e.confidence||0))[0]:this.getFallbackPlantInfo(t||"Unknown Plant")}formatPlantIdResponse(e){var t,a,n,i,s,l;if(!e.suggestions||0===e.suggestions.length)return null;const o=e.suggestions[0],c=o.plant_details;return{label:(null===(t=c.common_names)||void 0===t?void 0:t[0])||c.scientific_name,scientificName:c.scientific_name,confidence:o.probability,description:(null===(a=c.description)||void 0===a?void 0:a.value)||"No description available",commonNames:c.common_names||[],family:null===(n=c.taxonomy)||void 0===n?void 0:n.family,genus:null===(i=c.taxonomy)||void 0===i?void 0:i.genus,watering:(null===(s=c.watering)||void 0===s?void 0:s.max)||"Regular watering",light:"Bright indirect light",propagation:c.propagation_methods||[],edibleParts:c.edible_parts||[],image:null===(l=c.image)||void 0===l?void 0:l.value,gbifId:c.gbif_id,inaturalistId:c.inaturalist_id,synonyms:c.synonyms||[],source:"Plant.id"}}formatPlantNetResponse(e){var t,a;if(!e.results||0===e.results.length)return null;const n=e.results[0],i=n.species;return{label:(null===(t=i.commonNames)||void 0===t?void 0:t[0])||i.scientificNameWithoutAuthor,scientificName:i.scientificNameWithoutAuthor,confidence:n.score,description:"".concat(i.genus.scientificNameWithoutAuthor," species"),family:i.family.scientificNameWithoutAuthor,genus:i.genus.scientificNameWithoutAuthor,images:(null===(a=n.images)||void 0===a?void 0:a.map(e=>e.url.o))||[],source:"PlantNet"}}formatPerenualResponse(e){var t,a,n,i,s,l,o,c,r;return{label:e.common_name||(null===(t=e.scientific_name)||void 0===t?void 0:t[0]),scientificName:null===(a=e.scientific_name)||void 0===a?void 0:a[0],confidence:.7,description:e.description||"No description available",watering:e.watering||"Regular watering",light:(null===(n=e.sunlight)||void 0===n?void 0:n.join(", "))||"Bright indirect light",source:"Perenual",care:{hardiness:null!==(i=e.hardiness)&&void 0!==i&&i.min&&null!==(s=e.hardiness)&&void 0!==s&&s.max?"Zones ".concat(e.hardiness.min,"-").concat(e.hardiness.max):"Unknown",maintenance:e.maintenance||"Medium",growthRate:e.growth_rate||"Medium",droughtTolerant:e.drought_tolerant||!1,saltTolerant:e.salt_tolerant||!1,thorny:e.thorny||!1,invasive:e.invasive||!1,tropical:e.tropical||!1,indoor:e.indoor||!1,careLevel:e.care_level||"Medium"},dimensions:{minHeight:null===(l=e.dimension)||void 0===l?void 0:l.min_value,maxHeight:null===(o=e.dimension)||void 0===o?void 0:o.max_value,unit:null===(c=e.dimension)||void 0===c?void 0:c.unit},image:null===(r=e.default_image)||void 0===r?void 0:r.original_url,cycle:e.cycle,attracts:e.attracts||[],propagation:e.propagation||[],pruningMonth:e.pruning_month||[],pruningCount:e.pruning_count||[],seeds:e.seeds||0,flowers:e.flowers||!1,flowering_season:e.flowering_season,color:e.flower_color,soilRequirements:e.soil||[]}}getFallbackPlantInfo(e){const t={daisy:{label:"Daisy",scientificName:"Bellis perennis",description:"A common flowering plant with white petals and yellow center.",light:"Full sun to partial shade",watering:"Regular watering, allow soil to dry between waterings",uses:"Ornamental, medicinal (traditional use)"},rose:{label:"Rose",scientificName:"Rosa spp.",description:"Popular flowering shrub known for its fragrant blooms.",light:"Full sun (6+ hours daily)",watering:"Deep watering 1-2 times per week",uses:"Ornamental, cut flowers, essential oils"},sunflower:{label:"Sunflower",scientificName:"Helianthus annuus",description:"Large flowering plant that follows the sun across the sky.",light:"Full sun",watering:"Regular watering, drought tolerant when established",uses:"Seeds for food and oil, ornamental"}},a=e.toLowerCase().replace(/[^a-z]/g,"");for(const[n,i]of Object.entries(t))if(a.includes(n)||n.includes(a))return(0,s.A)({confidence:.5,source:"Fallback"},i);return{label:e||"Unknown Plant",scientificName:"Species not identified",description:"This appears to be a plant, but we could not identify the specific species. Consider consulting a local botanist or plant identification expert.",light:"Varies by species - observe current growing conditions",watering:"Monitor soil moisture - most plants prefer soil that dries slightly between waterings",uses:"Unknown - research before consumption or medicinal use",confidence:.1,source:"Generic Fallback"}}getCachedData(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.data:null}setCachedData(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}clearCache(){this.cache.clear()}};async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(t){return await r.identifyPlant(t,e)}return await r.getPlantCareInfo(e)}catch(a){return console.error("Plant info fetch failed:",a),r.getFallbackPlantInfo(e)}}var h=a(927),m=a(56),u=a(579);const g=e=>{var t,a;let{capturedImage:i,closeDialog:s}=e;const{detect:l,ready:o,classifiers:r,loading:g,error:p,modelCount:f}=c(),[v,w]=(0,n.useState)(null),[b,y]=(0,n.useState)(!1),[N,P]=(0,n.useState)(null),{setCurrentPlant:j,addToHistory:x,setDetecting:_,setDetectionProgress:C,setDetectionStep:I,preferences:E}=(0,m.gi)();(0,n.useEffect)(()=>{o&&i&&(async()=>{try{var e;y(!0),P(null),_(!0),I("Analyzing image with AI models..."),C(10);const t=await l(i,r);C(40),I("Identifying plant species...");let a=null;t.length>0&&(a=t[0]),C(60),I("Fetching detailed plant information...");const n=await d((null===(e=a)||void 0===e?void 0:e.label)||"Unknown Plant",i);C(90),I("Finalizing results..."),n&&a&&(n.mlConfidence=a.confidence,n.mlModel=a.model,n.combinedConfidence=(a.confidence+(n.confidence||0))/2),w(n),j(n),C(100),E.autoSave&&n&&x(n,i)}catch(t){console.error("Plant detection failed:",t),P(t instanceof Error?t.message:"Detection failed");try{const e=await d("Unknown Plant");w(e),j(e)}catch(a){console.error("Fallback also failed:",a)}}finally{y(!1),_(!1),C(0),I("")}})()},[o,i,l,r,j,x,E.autoSave,_,C,I]);const{detectionState:S}=(0,m.gi)();return g||b?(0,u.jsx)("div",{className:"plant-info-dialog",children:(0,u.jsxs)("div",{className:"plant-info-card",children:[(0,u.jsx)("span",{className:"plant-info-dialog-close",onClick:s,children:"\xd7"}),(0,u.jsx)(h.A,{size:"large",message:g?"Loading AI models...":"Analyzing Plant...",progress:S.progress,step:S.currentStep}),f>0&&(0,u.jsxs)("p",{className:"model-info",children:["Using ",f," AI model",f>1?"s":""]})]})}):p||N?(0,u.jsx)("div",{className:"plant-info-dialog",children:(0,u.jsxs)("div",{className:"plant-info-card",children:[(0,u.jsx)("span",{className:"plant-info-dialog-close",onClick:s,children:"\xd7"}),(0,u.jsx)("h2",{children:"Detection Error"}),(0,u.jsx)("p",{children:"We encountered an issue while analyzing your plant:"}),(0,u.jsx)("p",{className:"error-message",children:p||N}),(0,u.jsx)("p",{children:"Please try again with a clearer image of the plant."})]})}):v?(0,u.jsx)("div",{className:"plant-info-dialog",children:(0,u.jsxs)("div",{className:"plant-info-card",children:[(0,u.jsx)("span",{className:"plant-info-dialog-close",onClick:s,children:"\xd7"}),(0,u.jsxs)("div",{className:"plant-header",children:[(0,u.jsx)("h2",{className:"plant-name",children:v.label}),v.scientificName&&(0,u.jsx)("p",{className:"plant-scientific",children:(0,u.jsx)("em",{children:v.scientificName})}),(0,u.jsxs)("div",{className:"confidence-info",children:[v.combinedConfidence&&(0,u.jsxs)("span",{className:"confidence-badge",children:[Math.round(100*v.combinedConfidence),"% confident"]}),v.source&&(0,u.jsxs)("span",{className:"source-badge",children:["via ",v.source]}),v.mlModel&&(0,u.jsx)("span",{className:"model-badge",children:v.mlModel})]})]}),v.image&&(0,u.jsx)("div",{className:"plant-image-container",children:(0,u.jsx)("img",{className:"plant-image",src:v.image,alt:v.label,onError:e=>{e.target.style.display="none"}})}),v.description&&(0,u.jsxs)("div",{className:"plant-section",children:[(0,u.jsx)("h3",{children:"Description"}),(0,u.jsx)("p",{className:"plant-description",children:v.description})]}),(0,u.jsxs)("div",{className:"care-info",children:[v.light&&(0,u.jsxs)("div",{className:"care-item",children:[(0,u.jsx)("strong",{children:"\ud83d\udca1 Light:"})," ",v.light]}),(v.water||v.watering)&&(0,u.jsxs)("div",{className:"care-item",children:[(0,u.jsx)("strong",{children:"\ud83d\udca7 Water:"})," ",v.water||v.watering]}),(null===(t=v.care)||void 0===t?void 0:t.maintenance)&&(0,u.jsxs)("div",{className:"care-item",children:[(0,u.jsx)("strong",{children:"\ud83d\udd27 Maintenance:"})," ",v.care.maintenance]}),(null===(a=v.care)||void 0===a?void 0:a.hardiness)&&(0,u.jsxs)("div",{className:"care-item",children:[(0,u.jsx)("strong",{children:"\ud83c\udf21\ufe0f Hardiness:"})," ",v.care.hardiness]})]}),(v.family||v.genus)&&(0,u.jsxs)("div",{className:"plant-section",children:[(0,u.jsx)("h3",{children:"Taxonomy"}),v.family&&(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Family:"})," ",v.family]}),v.genus&&(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Genus:"})," ",v.genus]})]}),v.commonNames&&v.commonNames.length>1&&(0,u.jsxs)("div",{className:"plant-section",children:[(0,u.jsx)("h3",{children:"Common Names"}),(0,u.jsx)("p",{children:v.commonNames.join(", ")})]}),v.uses&&(0,u.jsxs)("div",{className:"plant-section",children:[(0,u.jsx)("h3",{children:"Uses"}),(0,u.jsx)("p",{children:v.uses})]}),v.edibleParts&&v.edibleParts.length>0&&(0,u.jsxs)("div",{className:"plant-section",children:[(0,u.jsx)("h3",{children:"\u26a0\ufe0f Edible Parts"}),(0,u.jsx)("p",{children:v.edibleParts.join(", ")}),(0,u.jsx)("p",{className:"warning",children:(0,u.jsx)("small",{children:"Always verify plant identification before consumption!"})})]}),v.propagation&&v.propagation.length>0&&(0,u.jsxs)("div",{className:"plant-section",children:[(0,u.jsx)("h3",{children:"Propagation"}),(0,u.jsx)("p",{children:v.propagation.join(", ")})]}),!1]})}):(0,u.jsx)("div",{className:"plant-info-dialog",children:(0,u.jsxs)("div",{className:"plant-info-card",children:[(0,u.jsx)("span",{className:"plant-info-dialog-close",onClick:s,children:"\xd7"}),(0,u.jsx)("h2",{children:"Plant Not Detected"}),(0,u.jsx)("p",{children:"We couldn't identify a plant in this image."}),(0,u.jsx)("p",{children:"Please try again with:"}),(0,u.jsxs)("ul",{children:[(0,u.jsx)("li",{children:"A clearer image of the plant"}),(0,u.jsx)("li",{children:"Better lighting conditions"}),(0,u.jsx)("li",{children:"Focus on leaves, flowers, or distinctive features"})]})]})})};var p=a(820);const f=e=>{let{type:t="info",title:a,message:i,onClose:s,closable:l=!0,autoClose:o=!1,autoCloseDelay:c=5e3,className:r=""}=e;const[d,h]=n.useState(!0),m=(0,n.useCallback)(()=>{h(!1),setTimeout(()=>{null===s||void 0===s||s()},300)},[s]);if((0,n.useEffect)(()=>{if(o&&s){const e=setTimeout(()=>{m()},c);return()=>clearTimeout(e)}},[o,c,s,m]),!d)return null;return(0,u.jsx)("div",{className:"alert-box alert-".concat(t," ").concat(r),children:(0,u.jsxs)("div",{className:"alert-content",children:[(0,u.jsx)("div",{className:"alert-icon",children:(()=>{switch(t){case"success":return"\u2705";case"error":return"\u274c";case"warning":return"\u26a0\ufe0f";default:return"\u2139\ufe0f"}})()}),(0,u.jsxs)("div",{className:"alert-text",children:[a&&(0,u.jsx)("div",{className:"alert-title",children:a}),(0,u.jsx)("div",{className:"alert-message",children:i})]}),l&&(0,u.jsx)("button",{className:"alert-close",onClick:m,"aria-label":"Close alert",children:"\xd7"})]})})},v=n.memo(e=>{let{offline:t}=e;const[a,s]=(0,n.useState)(null),[l,o]=(0,n.useState)(!1),[c,r]=(0,n.useState)(!1),[d,v]=(0,n.useState)(!1),[w,b]=(0,n.useState)(null),y=(0,m.EY)(),N=(0,m.dV)(),{addToHistory:P,setCurrentPlant:j}=(0,m.Yb)(),{setCameraActive:x,setCameraError:_}=(0,m.MI)(),C=(0,n.useRef)(null),I=(0,n.useRef)(null),E=(0,n.useCallback)(()=>{b(null)},[]),S=(0,n.useCallback)(async()=>{if(I.current)try{const e=I.current.takeBase64Photo({type:"jpeg",quality:2});o(!0),s(e.base64),N&&y&&P(y,e.base64)}catch(e){console.error("Failed to capture image:",e),_("Failed to capture image. Please try again.")}},[N,y,P,_]),A=(0,n.useCallback)(()=>{o(!1),s(null),j(null)},[j]),k=(0,n.useCallback)(e=>{r(!1),200===e.status?(y&&a&&P(y,a),b("Plant saved to your collection!"),A()):b("Sorry, we encountered an error saving your plant")},[r,A,y,a,P]),R=(0,n.useCallback)(()=>{if(a)if(t){const e="cloudy_pwa_",t=Math.random().toString(36).substring(2,5);localStorage.setItem("".concat(e).concat(t),a),b("Image saved locally, it will be uploaded to your library once internet connection is detected"),A()}else r(!0),k({status:200})},[a,t,A,k]),T=(0,n.useCallback)(e=>{const t=[];for(const a in localStorage)if(localStorage.hasOwnProperty(a)&&a.match(e)){const e=localStorage.getItem(a);localStorage.removeItem(a),t.push({key:a,val:e})}return t},[]),D=(0,n.useMemo)(()=>a?(0,u.jsx)(p.A,{src:a,alt:"captured plant",width:"350",height:"275",quality:.7,loading:"eager"}):null,[a]),O=(0,n.useCallback)(e=>()=>{v(e)},[]),U=(0,n.useMemo)(()=>l?(0,u.jsxs)("div",{className:"button-group",children:[(0,u.jsx)("button",{className:"discardButton",onClick:A,children:"Discard Plant"}),(0,u.jsx)("button",{className:"captureButton",onClick:S,children:"Scan Another"}),(0,u.jsx)("button",{className:"uploadButton",onClick:R,children:"\ud83d\udcbe Save Plant"}),(0,u.jsx)("button",{className:"infoButton",onClick:O(!0),children:"Show Plant Info"})]}):(0,u.jsx)("button",{className:"captureButton",onClick:S,children:"Scan Plant"}),[l,A,S,R,O]),L=(0,n.useMemo)(()=>c?(0,u.jsx)(h.A,{message:"Saving plant to your collection...",size:"small"}):null,[c]);return(0,n.useEffect)(()=>{const e=document.createElement("canvas");C.current&&(I.current=new i(C.current,e),I.current.setup().then(()=>{x(!0),_(null)}).catch(e=>{console.error("Camera setup failed:",e),_("Error getting access to your camera. Please check permissions."),x(!1)}))},[x,_]),(0,n.useEffect)(()=>{t||(()=>{const e=T(/^cloudy_pwa_/);e.length>0&&(r(!0),e.forEach(e=>{k({status:200})}),r(!1),b("All saved images have been uploaded to your Library"))})()},[t,k,T]),(0,u.jsxs)("div",{className:"uploadCanvas",children:[(0,u.jsxs)("div",{className:"mediaGroup",children:[(0,u.jsx)("video",{autoPlay:!0,playsInline:!0,muted:!0,ref:C,width:"100vw",height:"275"}),D&&(0,u.jsxs)("figure",{className:"imageCanvas",children:[D,(0,u.jsx)("figcaption",{children:"Image captured from feed."})]})]}),U,L,d&&a&&(0,u.jsx)(g,{capturedImage:a,closeDialog:O(!1)}),w&&(0,u.jsx)(f,{type:"info",message:w,onClose:E})]})});v.displayName="Canvas";const w=v},820:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(43),i=a(579);const s=n.memo(e=>{let{src:t,alt:a,width:s,height:l,className:o="",onClick:c,placeholder:r="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzUwIiBoZWlnaHQ9IjI3NSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkxvYWRpbmcuLi48L3RleHQ+PC9zdmc+",quality:d=.8,loading:h="lazy"}=e;const[m,u]=(0,n.useState)(r),[g,p]=(0,n.useState)(!1),[f,v]=(0,n.useState)("eager"===h),[w,b]=(0,n.useState)(!1),y=(0,n.useRef)(null),N=(0,n.useRef)(null),P=(0,n.useCallback)((e,t)=>new Promise(a=>{const n=document.createElement("canvas"),i=n.getContext("2d"),s=new Image;s.onload=()=>{const e=Math.min(800/s.width,800/s.height);n.width=s.width*e,n.height=s.height*e,null===i||void 0===i||i.drawImage(s,0,0,n.width,n.height);const l=n.toDataURL("image/jpeg",t);a(l)},s.src=e}),[]);(0,n.useEffect)(()=>{if("eager"!==h&&!f)return N.current=new IntersectionObserver(e=>{let[t]=e;var a;t.isIntersecting&&(v(!0),null===(a=N.current)||void 0===a||a.disconnect())},{threshold:.1,rootMargin:"50px"}),y.current&&N.current.observe(y.current),()=>{var e;null===(e=N.current)||void 0===e||e.disconnect()}},[h,f]),(0,n.useEffect)(()=>{if(!f)return;(async()=>{try{if(p(!1),b(!1),t.startsWith("data:image/")){const e=await P(t,d);u(e)}else u(t);p(!0)}catch(e){console.error("Failed to load image:",e),b(!0),u(r)}})()},[t,f,P,d,r]);const j=(0,n.useCallback)(()=>{p(!0)},[]),x=(0,n.useCallback)(()=>{b(!0),u(r)},[r]);return(0,i.jsxs)("div",{className:"optimized-image-container ".concat(o," ").concat(g?"loaded":"loading"," ").concat(w?"error":""),style:{width:s,height:l},onClick:c,children:[(0,i.jsx)("img",{ref:y,src:m,alt:a,className:"optimized-image",onLoad:j,onError:x,loading:h,style:{width:"100%",height:"100%",objectFit:"cover",transition:"opacity 0.3s ease-in-out"}}),!g&&!w&&(0,i.jsx)("div",{className:"image-loading-overlay",children:(0,i.jsx)("div",{className:"loading-spinner"})}),w&&(0,i.jsxs)("div",{className:"image-error-overlay",children:[(0,i.jsx)("span",{children:"\u26a0\ufe0f"}),(0,i.jsx)("p",{children:"Failed to load image"})]})]})});s.displayName="OptimizedImage";const l=s}}]);
//# sourceMappingURL=527.aa922408.chunk.js.map